<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recipe Browser</title>
    <!-- <link rel="stylesheet" href="../../_common/demo.css" media="screen"> -->
    <link rel="stylesheet" href="style.css" media="screen">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css" media="screen">

    <script>dojoConfig = {parseOnLoad: true}</script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.14.1/dojo/dojo.js"></script>
    <script src="./sample-recipes.js"></script>

    <script>
      const TITLE = 0;
      const INGREDIENTS = 1;
      const METHODS = 2;
    </script>

    <script>
      function ingredientFromId( recipeId, ingredientId ) {
	  // For recipe identified by recipeId, return the ingredient identified by ingredientId.
	  console.log( "ingredientFromId(%d, %d)", recipeId, ingredientId );
	  console.log( "recipe_name_array.length=%d", recipe_name_array.length );
	  if( recipeId < 0 || recipeId >= recipe_name_array.length ) {
	      return undefined;
	  } else {
	      let r = recipe_name_array[ recipeId ];
	      console.log( "r[%d].length=%d", INGREDIENTS, r[INGREDIENTS].length );
	      if( ingredientId < 0 || ingredientId >= r[ INGREDIENTS ].length ) {
		  return undefined;
	      } else {
		  console.log("ingredientFromId: returning [%s]", r[ INGREDIENTS ][ ingredientId ] );
		  return r[ INGREDIENTS ][ ingredientId ];
	      }
	  }
      }
    </script>
    
    <script>
      // TODO: use this function
      function checkbox_id(n,i) {return( "checkbox-" + n + "-" + i ); } 
      
      var addCheckBoxIngredient;
      require(["dijit/form/CheckBox", "dojo/domReady!"], function(CheckBox){
	  addCheckBoxIngredient=function(recipeId, ingredientId, refNode) {
	      // For recipe identified by recipeId, display a checkbox along with the ingredient identified by ingredientId
	      // as the last child of refNode.
	      let ingredient = ingredientFromId( recipeId, ingredientId );

	      require([
		  "dojo/dom",
		  "dojo/dom-construct",
		  "dojo/on",
		  "dojo/domReady!"
	      ], function(dom, domConstruct, on) {
		  // Create a checkbox
		  let checkbox = domConstruct.create("input", {
		      type: "checkbox",
		      id: checkbox_id( "ingredient", ingredientId )
		  });

		  // Create a label for the checkbox
		  let label = domConstruct.create("label", {
		      for: "myCheckbox",
		      innerHTML: "<span>" + ingredient + "</span>"
		  });

		  // Append the checkbox and label to the refNode
		  domConstruct.place( checkbox, refNode );
		  domConstruct.place( label, refNode );

		  // Add an event listener to the checkbox
		  on(checkbox, "change", function(event) {
		      console.log("Checkbox value: " + event.target.checked);
		      console.log('onChange called on checkbox#' + ingredientId + ' with parameter = ' + event.target.checked + "; event.target=" + event.target );
	       	      console.log("About to set innerHTML for checkBox" + ingredientId + " whose innerHTML = '" + label.innerHTML + "'" );
	       	      if( event.target.checked ) {
	       		  label.innerHTML = "<span class='ingredientClicked'>" + ingredient + "</span>";
	       	      } else {
	       		  label.innerHTML = "<span>" + ingredient + "</span>";
	       	      }
		  });
	      });
	  };
      });


      function addIngredients( recipe_id ) {
	  // Add all ingredients for RECIPE_ID.
	  console.log( "Adding these ingredients for '" + recipe_id + "': " + ingredient_map.get( recipe_id ) );
      }

      function addRecipes( recipe_name_array, refNode ) {
	  // Add recipes in RECIPE_NAME_ARRAY as an unordered list and place it as REFNODE
	  require([
	      "dojo/dom",
	      "dojo/dom-construct",
	      "dojo/on",
	      "dojo/domReady!"
	  ], function(dom, domConstruct, on) {
	      let previousCategory = undefined;

	      // Create a list container
	      let listContainer = domConstruct.create("ul");
	      let listSubContainer = undefined;

	      for( let r of recipe_name_array ) {
		  let cat = r[0];
		  let title = r[1];
		  let id = r[2];

		  if( cat !== previousCategory ) {
		      if( previousCategory !== undefined ) domConstruct.place( listSubContainer, listContainer );
		      listSubContainer = domConstruct.create("ul");
		      domConstruct.place( domConstruct.create( "li", { innerHTML: cat }), listContainer );
		      previousCategory = cat;
		  }

		  // Append list item to the list subcontainer
		  let listItem = domConstruct.create("li", { innerHTML: title });

		  // Add an event listener to each list item
		  on(listItem, "click", function() {
		      console.log("Clicked on: " + title);
		      addIngredients( id );
		  });

		  domConstruct.place( listItem, listSubContainer );
	      }

	      if( previousCategory !== undefined ) domConstruct.place( listSubContainer, listContainer );
	      // Append the list container to the body
	      domConstruct.place(listContainer, refNode);
	  });
      }
      </script>
  </head>
  
  <body class="claro">
    <div id="appLayout" class="demoLayout" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design: 'headline'">

      <div class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'top'">
	<center><h2>Top Header</h2></center>
      </div>

      <div class="centerPanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'center'">
	<center><h2>Method</h2></center>
	<div id="recipe_method"></div>
      </div>

      <div id="leftCol" class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'left', splitter: true">
	<center><h2>Recipes</h2></center>
      </div>

      <div id="rightCol" class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'right', splitter: true">
	<center><h2>Ingredients</h2></center>
	<div id="recipe_ingredients"></div>
      </div>

    </div>

    <script>
      addRecipes( recipe_name_array, "leftCol" );
    </script>

    <!-- load dojo -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"></script> -->
    <!-- <script> -->
      <!--   require(["dojo/parser", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dojo/domReady!"], function(parser){ -->
      <!-- 	  parser.parse(); -->
      <!--   }); -->
      <!-- </script> -->
  </body>
</html>
