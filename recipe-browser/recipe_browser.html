<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recipe Browser</title>
    <link rel="stylesheet" href="style.css" media="screen">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css" media="screen">

    <script>dojoConfig = {parseOnLoad: true}</script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.14.1/dojo/dojo.js"></script>
    <script src="./sample-recipes.js"></script>

    <script>
      const TITLE = 0;
      const INGREDIENTS = 1;
      const METHODS = 2;
    </script>
    
    <script>
      function addIngredients( recipe_id ) {
	  // Add all ingredients for RECIPE_ID.
	  require([
	      "dojo/dom",
	      "dojo/domReady!"
	  ], function(dom) {
	      let recipe_ingredients = dom.byId( "recipe_ingredients" );

	      if( typeof ingredients_map !== "undefined" ) {
		  let ingredients = ingredients_map.get( recipe_id );
		  if( ingredients )
		      recipe_ingredients.innerHTML = ingredients;
		  else
		      recipe_ingredients.innerHTML = "";
	      }
	  });
      }

      function addMethods( recipe_id ) {
	  // Add all methods for RECIPE_ID.
	  require([
	      "dojo/dom",
	      "dojo/domReady!"
	  ], function(dom) {
	      let recipe_method = dom.byId( "recipe_method" );

	      if (typeof methods_map !== "undefined") {
		  let method = methods_map.get( recipe_id );
		  if( method )
		      recipe_method.innerHTML = method;
		  else
		      recipe_method.innerHTML = "";
	      }

	      if (typeof yields_map !== "undefined") {
		  let yield = yields_map.get( recipe_id );
		  if( yield )
		      recipe_method.innerHTML =
		      recipe_method.innerHTML +
		      "<h2>Yield</h2>" +
		      yield;
	      }

	      if (typeof credits_map !== "undefined") {
		  let credit = credits_map.get( recipe_id );
		  if( credit )
		      recipe_method.innerHTML =
		      recipe_method.innerHTML +
		      "<h2>Credit</h2>" +
		      credit;
	      }
	  });
      }

      function handleItemClick() {
	  let item = event.target;
	  if( item.classList.contains( "itemClicked" ) ) {
	      item.classList.remove( "itemClicked" );
	  } else {
	      item.classList.add( "itemClicked" );
	  }
      }


      function addConditionalSpaceIfNextElementMatches( className, regex ) {
	  // For all elements that contain CLASSNAME,
	  // append a space to the text of the element if, and only if,
	  // the following element begins with the regular expression REGEX.

	  // Get all elements of class CLASSNAME
	  const conditionalSpaces = document.querySelectorAll( '.' +  className );

	  // Loop through each element and conditionally update its content
	  conditionalSpaces.forEach( element => {
	      console.log( "element = '" + element.textContent + "'" );
	      const nextElement = element.nextElementSibling;

	      // Get the first character of that next element
	      if( nextElement ) {
		  const text = nextElement.textContent.trim();
		  console.log( "considering '" + text + "'" );
		  const firstChar = text.charAt( 0 );

		  // Check if the first character is a word constituent (letter, digit, or underscore)
		  console.log( "firstChar = '" + firstChar + "'" );
		  const isFirstCharWordConstituent = regex.test( firstChar );

		  // Prepend a space to the element if the first character is a word constituent
		  if ( isFirstCharWordConstituent ) {
		      console.log( "\tadding space to '" + element.textContent + "'" );
		      element.textContent += ' ';
		      console.log( "\tadded space to '" + element.textContent + "'" );
		  }
	      }
	      console.log( "\n\n" );
	  });
      }

      function addRecipes( recipe_name_map, refNode ) {
	  // Add recipes in RECIPE_NAME_MAP as an unordered list and place it as REFNODE
	  require([
	      "dojo/dom",
	      "dojo/dom-construct",
	      "dojo/on",
	      "dojo/domReady!"
	  ], function(dom, domConstruct, on) {

	      // Create a list container
	      const listContainer = domConstruct.create("ul");

	      recipe_name_map.forEach( function( recipe_list, cat ) {
		  const catHeader = domConstruct.create("li", { innerHTML: cat });
		  domConstruct.place( catHeader, listContainer );

		  const listSubContainer = domConstruct.create("ul");
		  domConstruct.place( listSubContainer, catHeader );

		  console.log( "recipe_list= " + recipe_list.length + " ==> " + recipe_list );
		  recipe_list.forEach( function( recipe ) {
		      const recipeTitle = recipe[ 0 ];
		      const recipeId = recipe[ 1 ];

		      const listItem = domConstruct.create("li", { innerHTML: recipeTitle });
		      // Add an event listener to each list item
		      on(listItem, "click", function() {
			  let topHeader = dom.byId( "topHeader" );
			  topHeader.innerHTML = recipeTitle;
			  addIngredients( recipeId );
			  addMethods( recipeId );
		      });

		      domConstruct.place( listItem, listSubContainer );
		  });
	      });
	      domConstruct.place(listContainer, refNode);
	  });
	  addConditionalSpaceIfNextElementMatches( "conditional-space-after", /^[a-zA-Z0-9_]+$/ );
      }

      </script>
  </head>
  
  <body class="claro">
    <div id="appLayout" class="demoLayout" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design: 'headline'">

      <div class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'top'">
	<center><h1 id="topHeader">Recipe Browser</h2></center>
</div>

<div class="centerPanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'center'">
  <center><h2>Method</h2></center>
  <div id="recipe_method"></div>
</div>

<div id="leftCol" class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'left', splitter: true">
  <center><h2>Recipes</h2></center>
  <div id="recipe_titles"></div>
</div>

<div id="rightCol" class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'right', splitter: true">
  <center><h2>Ingredients</h2></center>
  <div id="recipe_ingredients"></div>
</div>

</div>

<script>

  addRecipes( recipe_name_map, "recipe_titles" );
</script>

<!-- load dojo -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"></script> -->
<!-- <script> -->
  <!--   require(["dojo/parser", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dojo/domReady!"], function(parser){ -->
  <!-- 	  parser.parse(); -->
  <!--   }); -->
  <!-- </script> -->
</body>
</html>
